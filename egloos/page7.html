<html>
<head>	<meta http-equiv='pragma' content='no-cache' />
	<meta http-equiv='cache-control' content='no-cache' />
	<meta http-equiv='Content-type' content='text/html; charset=utf-8' />
	<meta name="author" content="namhyung" />
	<meta name="keywords" content="F/OSS study" />
	<meta http-equiv="X-XRDS-Location" content="http://namhyung.myid.net/xrds" />
	<link rel="openid.server" href="http://www.myid.net/server" />
	<link rel="openid.delegate" href="http://namhyung.myid.net" />
	<link rel="shortcut icon" href="http://md.egloos.com/img/favicon.ico" />
	<link rel="pingback" href="https://rpc.egloos.com/rpc1" />
	<link rel="alternate" type="application/rss+xml" title="F/OSS study" href="http://rss.egloos.com/blog/studyfoss" />
	<title>F/OSS study</title>
	<script type="text/javascript" src="http://md.egloos.com/js/ap.js?ver=1.043"></script>
	<script type="text/javascript" src="http://md.egloos.com/js/gd.js?ver=1.002"></script>
	<script type="text/javascript" src="http://md.egloos.com/js/eg.js?ver=1.012"></script>
	<script type="text/javascript" src="http://md.egloos.com/js/cr.js?ver=1.002"></script>
    <script type="text/javascript" src="http://md.egloos.com/js/page/ins.js?ver=1.4"></script>
		
	<script type="text/javascript" src="http://md.egloos.com/js/lib/prototype_v1511.js"></script>
	<script type="text/javascript" src="http://md.egloos.com/js/control/Control.js"></script>
	<script type="text/javascript" src="http://md.egloos.com/js/control/Control.ImgModal.js?ver=1.004"></script>
	<script type="text/javascript" src="http://md.egloos.com/js/page/blog/compatible.js"></script>
	<script type="text/javascript" src="http://md.egloos.com/js/player.js"></script>
	
	<script type="text/javascript" src="http://md.egloos.com/js/lazyload.js"></script>
	
<link type="text/css" rel="stylesheet" href="http://md.egloos.com/css/egloos_template.css?ver=1.002" media="screen" />
<style type="text/css">
/* jiinny text-only skin
 */


BODY
{
	BACKGROUND : #FCFEFF;
	MARGIN : 0PX;
	PADDING : 0PX;
}

BODY,TD,DIV,LI
{
	FONT : 9PT/160% Tahoma, SANS-SERIF, Verdana, monaco,굴림,돋움,SANS-SERIF;
	COLOR : #33455E;
}

A:LINK		{ COLOR: #0000C0; TEXT-DECORATION: NONE; }
A:VISITED	{ COLOR: #0000C0; TEXT-DECORATION: NONE; }
A:ACTIVE	{ COLOR: #0000C0; TEXT-DECORATION: NONE; }
A:HOVER		{ COLOR: #C00000; TEXT-DECORATION: UNDERLINE; }

/* filter의 shadow보다 품질을 좋게 하기 위해서*/
DIV.HEADER
{
	FONT : BOLD 28PT/100% Georgia,나눔고딕,돋움,HY견고딕;
	TEXT-ALIGN=RIGHT;
	WIDTH=100%;
	PADDING-BOTTOM:10px;
	filter:progid:DXImageTransform.Microsoft.Blur;
}

#HEADER_SHADOW
{
	POSITION : relative;
	top :-50px; right:0px;
	FONT : BOLD 28PT/100% Georgia,나눔고딕,돋움,HY견고딕;
	TEXT-ALIGN=RIGHT;
	WIDTH=100%;
	PADDING-BOTTOM:10px;
}

#HEADER_SHADOW A:LINK		{ COLOR: #000080; TEXT-DECORATION: NONE; }
#HEADER_SHADOW A:VISITED		{ COLOR: #000080; TEXT-DECORATION: NONE; }
#HEADER_SHADOW A:HOVER		{ COLOR: #000080; TEXT-DECORATION: NONE; }

DIV.HEADER A:LINK		{ COLOR: #AAA; TEXT-DECORATION: NONE; }
DIV.HEADER A:VISITED	{ COLOR: #AAA; TEXT-DECORATION: NONE; }
DIV.HEADER A:HOVER	{ COLOR: #AAA; TEXT-DECORATION: NONE; }

DIV.URL			{ FONT : 8PT/100% VERDANA,TAHOMA; }
DIV.USERMENU
{
	POSITION:absolute:
	left:0px;
	top:0px;
	COLOR : #FFFFFF;
	FONT : bold 7pt;
	TEXT-ALIGN : RIGHT;
	MARGIN-BOTTOM : 50px;
	BACKGROUND : #000060;
	PADDING : 4px;
	BORDER-BOTTOM : 2px #336699 SOLID;
}
DIV.USERMENU A:LINK {COLOR:#FFF}
DIV.USERMENU A:VISITED {COLOR:#FFF}
DIV.USERMENU A:HOVER {COLOR:#FFF}

DIV.PROFILE
{
	WIDTH : 200PX;
	PADDING : 0PX 0PX 10PX;
	LINE-HEIGHT : 150%;
	OVERFLOW : HIDDEN;
}

DIV.MNTTL
{
	FONT:BOLD 10pt;
	WIDTH : 200PX;
	BORDER-BOTTOM :	1PX #888 DASHED;
	PADDING : 2PX 0PX 0PX;
	MARGIN : 25PX 0PX 10PX;
	TEXT-ALIGN:CENTER;
}

DIV.MNBODY
{
	font:9pt/135%;
	WIDTH :200PX;
}

DIV.POST { MARGIN-BOTTOM : 50PX;}

DIV.POST_HEAD
{
	MARGIN-BOTTOM : 15PX;
	PADDING-BOTTOM : 3PX;
}

DIV.POST_TTL
{
	TEXT-DECORATION: UNDERLINE;
	FONT: BOLD 10pt Georgia ;
	COLOR: #000;
}

DIV.POST_BODY
{
	FONT:10pt/150%;
	WIDTH : 100%;
	MARGIN-BOTTOM : 30PX;
	OVERFLOW : HIDDEN;
}

DIV.POST_BODY A:LINK
{
	COLOR: #4040CF;
	TEXT-DECORATION:none;
	border-bottom:1px DOTTED #4040CF
}

DIV.POST_BODY A:VISITED
{
	COLOR: #4040CF;
	TEXT-DECORATION: NONE;
	border-bottom:1px DOTTED #4040CF
}

DIV.POST_BODY A:HOVER
{
	COLOR: #CF4040;
	TEXT-DECORATION: NONE;
	border-bottom:1px DOTTED #CF4040
}


DIV.POST_TAIL {
	FONT : 11PX/150% VERDANA, TAHOMA, 돋움;
	MARGIN-TOP : 10PX;
	TEXT-ALIGN : RIGHT;
}

DIV.POST_TAIL A:LINK {COLOR: #006699; TEXT-DECORATION: NONE; }
DIV.POST_TAIL A:VISITED {COLOR: #006699; TEXT-DECORATION: NONE; }
DIV.POST_TAIL A:HOVER {COLOR: #006699; TEXT-DECORATION: NONE; border-bottom:1px dotted #cc0000}

DIV.COMMENT
{
	BORDER : 1PX #D3D3D3 SOLID;
	BACKGROUND : #F7F7F7;
	PADDING : 15PX;
	MARGIN : 20PX 0PX;
}

DIV.COMMENT_BODY
{
	MARGIN-BOTTOM : 20PX;
}

DIV.COMMENT_TAIL
{
	MARGIN : 8PX 0PX 5PX;
	FONT : 8PT/150% VERDANA, TAHOMA, 돋움;
	COLOR : #777;
}

DIV.COMMENT_INPUT
{
	MARGIN-TOP : 20PX;
	BORDER-TOP : 1PX #AAA DOTTED;
	PADDING-TOP : 20PX;
}

DIV.COMMENT_LINE
{
	BORDER-TOP : 1PX #AAA DOTTED;
	MARGIN : 10PX 0PX 15PX;
}
DIV.POST_BODY IMG
{
	filter:
	progid:DXImageTransform.Microsoft.DropShadow(color=#CCCCCC,offX=3, offY=3)
	border:1px #000 solid;
}

DIV.VERSION
{
  font-weight: bold;
  color: white;
  background: #525d76;
  border: 1px solid silver;
#  margin: 0.5em 10% 0.5em 1em;
  padding: 0.5em;
}

DIV.SOURCE
{
  font-family: monospace, Courier New, Seoul;
#  margin: 0.5em 10% 0.5em 1em;
  margin: 1em;
  color: navy;
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

BLOCKQUOTE
{
	font: 9pt/150% Courier New, Seoul;
	Border: 1px #DDD dotted;
	padding:5px;
	color:#000;
	margin:20px;
}

/* begin style of emphasis */
.BOX1
{
	font: 9pt/150% Courier New, Seoul;
	Border: 1px #DDD SOLID;
	padding:5px;
	color:#00FF00;
	background:#000;
	margin:20px;
}

.BOX2
{
	font: 9pt/150% Courier New, Seoul;
	Border: 1px #DDD SOLID;
	padding:5px;
	color:#FFC000;
	background:#000;
	margin:20px;
}

.EM1
{
	background : #FFFF80;
}

.EM2
{
	background : #F0C0FF;
}
/* end style of emphasis */

#RIGHTMAIN{ POSITION: ABSOLUTE; RIGHT:300px; LEFT:40px;}

#LEFTSIDE
{
	POSITION: ABSOLUTE;
	TOP:60PX;
	RIGHT: 20PX;
	FONT: 9PT;
	WIDTH:200PX;
	BORDER-LEFT: 2PX #BCBDC4 DASHED;
	PADDING: 20PX;
}

#LEFTSHOW
{
	TOP:60PX;
	RIGHT: 0PX;
	FONT: 7PT/150%;
	WIDTH:7px;
	HEIGHT:200px;
	BACKGROUND:#DDDDDD;
	POSITION: ABSOLUTE;
	CURSOR:HAND;
	BORDER-TOP: 3PX #7598A3 SOLID;
	BORDER-LEFT: 2PX #7598A3 DASHED;
	BORDER-BOTTOM: 3PX #7598A3 SOLID;
}

#LEFTHIDE
{
	TOP:63PX;
	RIGHT: 23PX;
	FONT: 7PT/150%;
	POSITION: ABSOLUTE;
	CURSOR:HAND;
	WIDTH:18px;
	HEIGHT:18px;
	TEXT-ALIGN:CENTER;
}
#BOTTOMBANNER
{
	TEXT-ALIGN=CENTER;
	WIDTH=100%;
}

IMG.IMG_DECO
{
	TEXT-ALIGN:CENTER;BORDER:1px #000 SOLID;
	filter:progid:DXImageTransform.Microsoft.DropShadow(color=#AAAAAA,offX=3, offY=3)
}

#LOGO
{
	WIDTH=200;
	TEXT-ALIGN=CENTER;
	FILTER:
	progid:DXImageTransform.Microsoft.DropShadow(color=#CCCCCC,offX=3, offY=3)
	progid:DXImageTransform.Microsoft.Glow(Color=#AAAAAA, strength=5)
}

/* 여기서 부터는 시스템에관한 클래스 이므로 변경하지 않으시는 것이 좋습니다. */

DIV.TRACK_TOP { LINE-HEIGHT : 170%; }
DIV.ARCHIVE_HEAD { FONT-WEIGHT : BOLD; MARGIN-BOTTOM : 10PX; }
DIV.ARCHIVE_BODY { MARGIN : 20PX 0PX; LINE-HEIGHT : 160%; PADDING-BOTTOM : 100PX; }

IMG.IMAGE_TOP	{ MARGIN-BOTTOM : 15PX; }
IMG.IMAGE_LEFT	{ MARGIN-RIGHT : 15PX; MARGIN-BOTTOM : 15PX; }
IMG.IMAGE_MID	{ MARGIN-TOP : 15PX; MARGIN-BOTTOM : 15PX; }
IMG.BOOKMK		{ MARGIN : 10PX; BORDER : 0PX; }
IMG.USERMENU	{ MARGIN-LEFT : 8PX; }
IMG.LOGO
{
BORDER: 1PX #000 SOLID;
}

DIV.BANNER	{ MARGIN-TOP : 30PX; }

.SMALL		{ FONT-SIZE : 11PX; }
.DATE		{ FONT : BOLD 8PT/150% VERDANA, TAHOMA, 돋움; }
.TIME		{ FONT : 8PT/150% VERDANA, TAHOMA, 돋움; TEXT-ALIGN : LEFT; }
.AUTHOR		{ FONT : BOLD 9PT; }
.TXTFLD		{ FONT-SIZE:9PT;COLOR:#000; BORDER:1PX SOLID #666678; BACKGROUND:#FFF; }



/* 여기서 부터는 달력 및 XML에 관련된 클래스입니다. */


DIV.CAL_TOP { }
DIV.CAL { MARGIN : 20PX 0PX 20PX; WIDTH : 200PX; TEXT-ALIGN : CENTER;}
DIV.CAL_HEAD { WIDTH : 150PX; FONT : 8PT/150% VERDANA; TEXT-ALIGN : CENTER; PADDING : 4PX 0PX; MARGIN-BOTTOM : 10PX;}
DIV.CAL_BODY { WIDTH : 200PX; TEXT-ALIGN : CENTER;}
DIV.CAL_BOTTOM { }

.CAL
{
	FONT : 7PT/170% VERDANA, 돋움;
	TEXT-ALIGN : CENTER;
}

.CAL_DAY
{
	FONT : BOLD 7PT/170% VERDANA, 돋움;
	TEXT-ALIGN : CENTER;
	BACKGROUND : #CCC;
}

.CAL_SUN
{
	FONT : BOLD 7PT/170% VERDANA, 돋움;
	COLOR : #D36654;
	TEXT-ALIGN : CENTER;
	BACKGROUND : #CCC;
}

.CAL_SAT
{
	FONT : BOLD 7PT/170% VERDANA, 돋움;
	COLOR : #3572A1;
	TEXT-ALIGN : CENTER;
	BACKGROUND : #CCC;
}

.CAL_TODAY
{
	FONT : BOLD 7PT/170% VERDANA, 돋움;
	BACKGROUND : #E3E3E3;
	COLOR : #3D5586;
	TEXT-ALIGN : CENTER;
	BORDER : 1px #AAA SOLID;
}

.CAL_TR
{
	BACKGROUND:#EFEFEF;
}

DIV.XML { FONT : 8PT/150% VERDANA; TEXT-ALIGN : CENTER; }
   div.memobody {
       width : 200px;
       overflow : hidden;
       }
   </style>
<link type="text/css" rel="stylesheet" href="http://md.egloos.com/css/egloo_navibar.css?ver=1.2" media="screen" />
<link type="text/css" rel="stylesheet" href="http://md.egloos.com/css/common/popup.css?ver=2.00" />
<link type="text/css" rel="stylesheet" href="http://md.egloos.com/css/common/button.css" />
<script type="text/javascript" src="http://md.egloos.com/js/modal/Modal.js"></script>
<script type="text/javascript" src="http://md.egloos.com/js/modal/Modal.Center.js"></script>
<script type="text/javascript" src="http://md.egloos.com/js/page/blog/Modal.BookmarkDlg.js?ver=1.002"></script>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function() {
    new Modal.BookmarkDlg('egloo_bookmark', {overlay: true,
                'groupURL'     : "/exec/egloo_bookmark_group.php",
                'remoteURL'    : "/exec/egloo_insbookmark_exec.php"});
    if(''==''){
	    	copy_contents('studyfoss.egloos.com','namhyung','0');
    }
});
//]]>
</script></head>
<body>
<iframe name="cmtviewfrm" id="cmtviewfrm" src="about:blank" width="0" height="0" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" style="display:block;border:0px;"></iframe>
<DIV CLASS=USERMENU>  
<a href="http://www.egloos.com">Egloos</a> | <a href="http://sec.egloos.com/login.php?returnurl=http%3A%2F%2Fstudyfoss.egloos.com%2Fpage%2F7">Log-in</a> </DIV>

<DIV ID=RIGHTMAIN>
<DIV CLASS=HEADER><a href="http://studyfoss.egloos.com" name="egloo_title">F/OSS study</a></DIV>
<DIV ID=HEADER_SHADOW><a href="http://studyfoss.egloos.com" name="egloo_title">F/OSS study</a></DIV>
<!--		<DIV CLASS=URL><a href="http://studyfoss.egloos.com" name="egloo_url">studyfoss.egloos.com</a></DIV>-->
		<!-- egloos content start -->
<div class='hentry'><span class='copyright_entry' style='display:none;' title='[Linux] concurrency managed workqueue (cmwq)@@**@@http://studyfoss.egloos.com/5626173'></span><DIV CLASS=POST>
	<DIV CLASS=POST_HEAD>
	<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH=100%>
	<TR><TD WIDTH=80%><DIV CLASS=POST_TTL><img src=http://md.egloos.com/img/vl/ico_star_o.gif> <a name="5626173" title="[Linux] concurrency managed workqueue (cmwq)">[Linux] concurrency managed workqueue (cmwq)</a></DIV></TD>
		<TD WIDTH=20% ALIGN=RIGHT></TD></TR>
	</TABLE>
	</DIV>
	<DIV CLASS=POST_BODY>
	<div class="version">Linux: 3.3-rc1</div><br/><br/>workqueue는 특정 작업을 별도의 process context에서 실행하고 싶은 경우 사용하는<br/>커널 API로 커널 내의 다양한 위치에서 널리 사용된다. 이는 일종의 thread pool의<br/>개념으로 볼 수 있으며, workqueue 시 생성 시에 작업용 thread들을 미리 만들어 둔<br/>뒤, 이후에 필요한 work가 발생되었을 때 해당 thread를 이용하여 수행하는 방식이다.<br/><br/>기존의 구현 방식은 (singlethread 모드가 아닌) workqueue 생성 시 시스템에<br/>존재하는 CPU 수 만큼의 worker_thread를 만들어두고, 이후 (queue_work 혹은<br/>schedule_work 등의 API를 통해) work가 생성되었을 때 해당 CPU에 배정된<br/>worker_thread가 그 work를 수행하는 식이었다.<br/><br/>가령 4개의 CPU 코어를 가진 시스템에서 workqueue는 다음 그림과 같은 형태로<br/>구성될 것이다.<br/><br/><div style="text-align:center"><img class="image_mid" border="0" onmouseover="this.style.cursor='pointer'" alt="" src="http://pds24.egloos.com/pds/201201/27/35/c0098335_4f22552b4ca6c.png" width="500" height="375" onclick="Control.Modal.openDialog(this, event, 'http://pds24.egloos.com/pds/201201/27/35/c0098335_4f22552b4ca6c.png');" /></div><br/>하지만 이러한 방식은 매우 많은 수의 CPU를 가진 시스템에서, 많은 수의 workqueue가<br/>사용될 경우 worker thread를 위해 너무 많은 task가 만들어진다는 단점이 있다.<br/>특히 task를 생성하려면 pid를 부여해야 하는데 미리 만들어둔 worker thread로<br/>인해 pid가 모자라게 되는 상황이 발생할 수도 있다.<br/><br/>사실 2.6.35 이후에는 시스템 내의 CPU 수를 파악하여 가능한 최대 pid 번호를 부팅<br/>시 동적으로 조정할 수 있게 되었지만 어쨌든 이렇게 많은 수의 task가 생성된다는<br/>것은 그많큼 많은 자원이 사용된다는 의미이므로 그리 바람직하지 않다고 볼 수 있다.<br/><br/>그보다 더 큰 문제는 이렇게 많은 worker thread들이 생성되었음에도 불구하고 이들<br/>thread들 간에 협업이 불가능하기 때문에 생각만큼 충분한 병렬성(concurrency)을<br/>제공하지 못한다는 점이었다.<br/><br/>이러한 문제를 해결하기 위해 2.6.36 버전에서 도입된 새로운 workqueue의 구현이<br/>바로 cmwq이다. cmwq는 각 CPU별로 공유되는 gcwq (global per-cpu wq)를 도입하여<br/>worker thread를 관리하며, 각 wq는 여전히 내부적으로 cwq(per-cpu wq)를 통해<br/>work를 관리하긴 하지만 이를 gcwq로 보낼 때의 동작을 제어할 수 있게 된다.<br/>cmwq의 대략적인 구조는 다음과 같다.<br/><br/><div style="text-align:center"><img class="image_mid" border="0" onmouseover="this.style.cursor='pointer'" alt="" src="http://pds23.egloos.com/pds/201201/27/35/c0098335_4f22554946dd6.png" width="500" height="375" onclick="Control.Modal.openDialog(this, event, 'http://pds23.egloos.com/pds/201201/27/35/c0098335_4f22554946dd6.png');" /></div><br/>기본적인 차이점으로는 앞서 말했듯이 worker thread가 각각의 workqueue 단위가<br/>아닌 CPU (gcwq) 단위로 관리된다는 것인데, wq로 보내진 work는 다시 gcwq로<br/>전달되어 처리되도록 변경되었다. wq에서 gcwq로 보낼 수 있는 work의 수는 wq 할당<br/>시 max_active 인자로 지정할 수 있으며, 기존의 create_workqueue() API를 사용하는<br/>경우 1로 지정된다. 만약 max_active 인자로 0을 주면 기본값인 256으로 지정된다.<br/><br/>이 active 카운트 값은 cwq 마다 따로 관리되며, gcwq로 work를 전달 시에 증가되고<br/>해당 work가 수행되고나면 감소한다. 만약 max_active 보다 많은 work가 wq로 보내진<br/>경우 해당 cwq의 delayed_works 리스트에 보관된다.<br/><br/>gcwq는 각각의 cwq에서 보내진 work들을 queue로 관리하며 차례대로 worker thread를<br/>통해 수행한다. 이 worker thread들의 이름은 "kworker/0:0" 형태가 되는데 첫번째<br/>숫자는 gcwq의 CPU 번호에 해당하고 두번째 숫자는 해당 thread의 ID이다.<br/><br/>worker thread는 시스템 부팅 초기에 각 gcwq 마다 하나씩 할당되며, 시스템 동작<br/>중에 필요에 따라 할당/제거될 수 있다. 기본적으로는 gcwq는 주어진 work를 하나씩<br/>순서대로 처리하며 하나의 work가 완료된 후에 다음 work를 처리한다. 하지만 work는<br/>process context에서 처리되기 때문에 수행 도중 sleep될 수 있는데 이 때 (기존<br/>workqueue 구현에서처럼) 단순히 이전 work가 완료되기를 기다리며 다음 work를<br/>수행하지 않는 것은 CPU 자원을 낭비하는 결과가 되므로 이 경우 새로운 worker<br/>thread를 생성하여 바로 다음 work를 처리하도록 하는 것이 cmwq의 아이디어이다.<br/>(cmwq에서 말하는 concurrency는 바로 이것을 의미한다.)<br/><br/>worker thread는 주어진 work들을 처리하기 전후에 worker thread의 수를 관리해야<br/>할 지를 검사하여 이를 조정한다. 만약 gcwq 내에 주어진 work thread가 있지만 현재<br/>실행 중인 worker thread가 없다면 새로운 worker를 생성하고, 주어진 work가 없고<br/>3개 이상의 worker thread가 (또한 실행 중인 worker thread가 많지 않아야 한다)<br/>idle 상태라면 5분 이상 idle 상태인 worker thread를 차례로 제거하게 되므로 보통<br/>실행 환경에서는 CPU마다 2개의 worker thread가 존재한다고 볼 수 있다.<br/><br/>이러한 여러 동작들을 제어하기 위해 workqueue 생성 시 추가적으로 flags 인자를<br/>넘길 수 있는데 이는 다음과 같은 값들의 bitmask이다.<br/><ul><li><span style="font-weight: bold;">WQ_NON_REENTRANT</span>: 주어진 work가 동시에 여러 번 실행되지 않는다는 것을 보장해준다. 만약 이 플래그가 없다면 해당 work가 실행되는 도중 다른 CPU에서 동시에 동일한 work를 실행할 수도 있다.</li><li><span style="font-weight: bold;">WQ_UNBOUND</span>: 이 workqueue는 CPU마다 work를 배정하지 않고 그때그때 현재 CPU에서 work를 실행한다. 이 경우 worker thread는 WORKER_NOT_RUNNING 상태이므로 idle worker가 없다면 항상 새로운 worker를 생성하여 작업을 수행하게 될 것이다.</li><li><span style="font-weight: bold;">WQ_FREEZABLE</span>: 이 workqueue를 통해 수행되는 work는 시스템이 절전 상태로 빠지는 경우 실행이 중단된다.</li><li><span style="font-weight: bold;">WQ_MEM_RECLAIM</span>: 이 workqueue를 통해 수행되는 work는 메모리 할당/해제 과정에서 사용될 수 있음을 뜻한다. 따라서 시스템의 메모리가 부족한 상황에서 기존의 worker thread들이 모두 실행 중이라면 새로운 work를 수행하기 위한 worker thread를 할당하지 못할 수 있다. 하지만 시스템의 메모리를 확보하기 위해 해당 work를 반드시 수행해야만 한다면 (예를 들어, dirty page를 swap 영역에 write해야 하는 경우) 이는 시스템 전체를 마비시키는 결과를 가져올 것이다. 이를 방지하기 위해 새로운 worker thread를 할당하지 못한 경우 rescuer thread를 미리 만들어두고 비상 시에 이를 이용하여 work를 수행할 수 있도록 해 준다.</li><li><span style="font-weight: bold;">WQ_HIGHPRI</span>: 일반적으로 work는 queue로 관리되므로 주어진 순서대로 차례로 처리되지만 이 플래그가 설정된 wq를 통해 보내진 work는 그렇지 않은 work보다 먼저 처리되도록할 수 있다. 또한 WQ_HIGHPRI가 설정된 work 간에는 FIFO 순서가 보장된다.</li><li><span style="font-weight: bold;">WQ_CPU_INTENSIVE</span>: 이 workqueue를 통해 수행되는 work는 cmwq의 worker thread 관리 대상에 포함되지 않으므로 gcwq는 이에 상관없이 다른 work를 수행할 수 있다. 하지만 WQ_HIGHPRI와는 달리 해당 work가 실행되는 순서에는 영향을 주지 않는다.</li></ul>schedule_work() API등을 통해 기본적으로 사용되는 system_wq (keventd) 외에도<br/>이러한 다양한 플래그를 지원하는 여러 system-level wq들이 추가적으로 많이 제공되므로<br/>GPL을 사용하는 모듈의 경우 필요에 따라 적절한 wq를 선택하여 사용할 수 있을 것이다.<br/><br/><div style="clear:both; _display: none;"></div><div class="posttaglist"><a href="/tag/linux" rel="tag">linux</a>,&nbsp;<a href="/tag/kernel" rel="tag">kernel</a></div>
       <!--
       <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
		    xmlns:dc="http://purl.org/dc/elements/1.1/"
		    xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
       <rdf:Description
	        rdf:about="http://studyfoss.egloos.com/5626173"
	        dc:identifier="http://studyfoss.egloos.com/5626173"
	        dc:title="[Linux] concurrency managed workqueue (cmwq)"
	        trackback:ping="http://studyfoss.egloos.com/tb/5626173"/>
       </rdf:RDF>
       -->

	</DIV>
	<DIV CLASS=POST_TAIL ALIGN=RIGHT><span class="TIME"> <a href="/5626173" class="permalink" title="[Linux] concurrency managed workqueue (cmwq)" rel="bookmark">#</a> by <span class="AUTHOR">namhyung</span> | <a href="/5626173" class="time"  title="[Linux] concurrency managed workqueue (cmwq)" rel="bookmark">2012/01/28 11:08</a></span> | <a href="/category/Kernel" class="category">Kernel</a> | <span class="linkback"><a href="#trb" onclick="trbview('5626173','c0098335','0'); return false;" class="tail_trb">트랙백<span id="trbcnt5626173"></span></a></span> | <span class="linkback"><a href="#cmt" onclick="cmtview('5626173','c0098335','0'); return false;" class="tail_cmt">덧글(<span id="cmtcnt5626173">10</span>)</a></span></DIV>
		<span id="cmt5626173"></span>
</DIV>
</div><!-- egloos content end -->
<span style="float: left"><a href="/page/6">◀ 이전 페이지</a></a></span>
<span style="float: right"><a href="/page/8">다음 페이지 ▶</a></span>
<BR><BR>
<DIV ID='BOTTOMBANNER' style="display:none;">	<div class="BANNER"><a href="http://www.egloos.com"><img src="http://md.egloos.com/img/edt/banner_ffffff_1.gif" width="150" height="50" border="0" alt="Powered by egloos" /></a></div>
<BR><BR></DIV>
</DIV>
<DIV ID=LEFTSIDE style="display:block;">
	<DIV ID=LOGO></DIV>
	     <script language="javascript" type="text/javascript">
     <!--
     var s_calendar = new Array();
     s_calendar = [];
	  calendar("","");
     -->
     </script>

	
<DIV CLASS=MNTTL>카테고리</DIV>
<DIV CLASS=MNBODY>
<a href="/category/General">General</a><br/><a href="/category/Application">Application</a><br/><a href="/category/System">System</a><br/><a href="/category/Kernel">Kernel</a><br/><a href="/category/Book">Book</a><br/><a href="/category/Tips">Tips</a><br/>
</DIV>

<DIV CLASS=MNTTL>태그</DIV>
<DIV CLASS=MNBODY><a href="/tag/documentation" class="tlevel1"> documentation</a>
<a href="/tag/build" class="tlevel3"> build</a>
<a href="/tag/linux" class="tlevel3"> linux</a>
<a href="/tag/algorithm" class="tlevel3"> algorithm</a>
<a href="/tag/glibc" class="tlevel3"> glibc</a>
<a href="/tag/perf" class="tlevel1"> perf</a>
<a href="/tag/sed" class="tlevel1"> sed</a>
<a href="/tag/awk" class="tlevel1"> awk</a>
<a href="/tag/vcs" class="tlevel1"> vcs</a>
<a href="/tag/CAaQA3" class="tlevel3"> CAaQA3</a>
<a href="/tag/emacs" class="tlevel3"> emacs</a>
<a href="/tag/blktrace" class="tlevel1"> blktrace</a>
<a href="/tag/script" class="tlevel1"> script</a>
<a href="/tag/gcc" class="tlevel3"> gcc</a>
<a href="/tag/kernel" class="tlevel3"> kernel</a>
<a href="/tag/CARM" class="tlevel1"> CARM</a>
<a href="/tag/synchronization" class="tlevel3"> synchronization</a>
<a href="/tag/scm" class="tlevel1"> scm</a>
<a href="/tag/SMP" class="tlevel2"> SMP</a>
<a href="/tag/memory" class="tlevel3"> memory</a>
<a href="/tag/block-layer" class="tlevel2"> block-layer</a>
<a href="/tag/binutils" class="tlevel2"> binutils</a>
<a href="/tag/C" class="tlevel3"> C</a>
<a href="/tag/computer-architecture" class="tlevel3"> computer-architecture</a>
<a href="/tag/compiler" class="tlevel3"> compiler</a>
<a href="/tag/bash" class="tlevel2"> bash</a>
<a href="/tag/x86" class="tlevel3"> x86</a>
<a href="/tag/elf" class="tlevel3"> elf</a>
<a href="/tag/patch" class="tlevel3"> patch</a>
<a href="/tag/git" class="tlevel2"> git</a>
<div style="text-align:right;margin-top:5px;"><a href="/tag">전체보기</a></div>
</DIV>

<DIV CLASS=MNTTL>이글루 파인더</DIV>
<DIV CLASS=MNBODY><form id="finder" style="margin:0;" name="finder" method="post" action="http://studyfoss.egloos.com/" onsubmit="return go_search(document.finder);"><input type="text" id="srch_kwd" name="srch_kwd" size="10" style="vertical-align: middle;width: 100px;font-size:12px;" maxlength="30"/><input type="image" style="vertical-align: middle;margin-left:3px;" src="http://md.egloos.com/img/fnd/searchb.gif" /><p style="margin:3px 0 0 13px;text-align:left"><a href="http://www.zum.com" target="_blank"><img src="http://md.egloos.com/img/search/txt_power.png"></a></p></form>
</DIV>

<DIV CLASS=MNTTL>최근 등록된 덧글</DIV>
<DIV CLASS=MNBODY>
<style type="text/css"> 
.reply_write {margin:10px 0;}
.reply_write fieldset {border:none;margin:0;padding:0;}
.reply_write legend {display:none;}
.reply_write .comment_info {width:95%;}
.reply_write .comment_info span.comment_name,
.reply_write .comment_info span.comment_passwd,
.reply_write .comment_info span.comment_blog {display:block;padding:0 0 2px 0;clear:both;}
.reply_write .comment_info span.comment_blog {float:left;}
.reply_write .comment_info span.comment_name label,
.reply_write .comment_info span.comment_passwd label,
.reply_write .comment_info span.comment_blog label {display:block;float:left;width:55px;}
.reply_write .comment_info input {padding:1px 0 0 1px;vertical-align:middle;}
.reply_write .comment_info input.name {width:100px;}
.reply_write .comment_info input.passwd {width:60px;}
.reply_write .comment_info input.blog {width:200px;font-family:tahoma,sans-serif;font-size:11px;}
.reply_write .comment_info span.comment_now {display:none;}
.reply_write .comment_info span.comment_login {float:right;}
.reply_write textarea {margin:2px 0;padding:0;width:95%;height:100px;margin-left:0 !important;font:normal 12px '돋움',sans-serif;}
.reply_write .comment_btn {width:95%;height:23px;position:relative;*position:static;*text-align:right;}
.reply_write .comment_btn .comment_submit {position:absolute;top:0;right:0;*position:static;*text-align:right;}
</style>     

<a href="http://studyfoss.egloos.com/5129119#12438993">이렇게 좋은 글이 한글로 있다는 것..</a><br/><span class="SMALL">by 프로그라머 at 02/17</span><br/><div style="margin:12px;"></div><a href="http://studyfoss.egloos.com/5512112#12419757">흐름을 이해할 수 있는글이라 좋..</a><br/><span class="SMALL">by morenice at 11/26</span><br/><div style="margin:12px;"></div><a href="http://studyfoss.egloos.com/4951809#12401092">좋은 글 감사합니다~퍼갑니다~</a><br/><span class="SMALL">by 김석범 at 09/10</span><br/><div style="margin:12px;"></div>
</DIV>

<DIV CLASS=MNTTL>최근 등록된 트랙백</DIV>
<DIV CLASS=MNBODY>
<a href="http://studyfoss.egloos.com/5350643#515727">이맥스의 파일 변수 사용하기</a><br/><span class="SMALL">by 개똥이야기</span><br/><div style="margin:12px;"></div><a href="http://studyfoss.egloos.com/4951809#512679">asmlinkage modifier in Linux..</a><br/><span class="SMALL">by novum의 공유창고</span><br/><div style="margin:12px;"></div><a href="http://studyfoss.egloos.com/5409933#511713">구조체의 패킹에 대한 이야기</a><br/><span class="SMALL">by 김재호의 디지털보단 아날로그</span><br/><div style="margin:12px;"></div>
</DIV>








<DIV style="TEXT-ALIGN:center; width:200px;">
<div class="XML"><a href="http://rss.egloos.com/blog/studyfoss" target="_new"><img src="http://md.egloos.com/img/skn/rss.gif" alt="rss" border="0" /></a><br /><br /> skin by <a href="http://jiinny.egloos.com">jiinny</a></div>
<BR /><BR />
<DIV ID=OHLOH><a href='https://www.ohloh.net/accounts/115130?ref=Detailed'>
  <img alt='Ohloh profile for Namhyung Kim' height='35' src='https://www.ohloh.net/accounts/115130/widgets/account_detailed.gif' width='191' border='0' />
</a></DIV>
</DIV>
</DIV>
<DIV ID='LEFTSHOW'  onclick=document.all['RIGHTMAIN'].style.right='300px';document.all['BOTTOMBANNER'].style.display='none';document.all['LEFTSIDE'].style.display='block';document.all['LEFTSHOW'].style.display='none';document.all['LEFTHIDE'].style.display='block';  style='color:red;display:none;'>
</DIV>

<DIV id='LEFTHIDE' onclick=document.all['RIGHTMAIN'].style.right='20px';document.all['BOTTOMBANNER'].style.display='block';document.all['LEFTSIDE'].style.display='none';document.all['LEFTHIDE'].style.display='none';document.all['LEFTSHOW'].style.display='block';  style='color:red'>X</DIV><iframe src="http://www.egloos.com/estat/stat_logger.php?bid=c0098335&ref=&openflag=" style="width: 0px; height: 0px; border: 0px solid #fff;"></iframe>
<img width="0" height="0" border="0" src="http://studyfoss.egloos.com/egloo_pds.php?eid=c0098335" alt="" />
<form id="trackfrom" name="trackfrom" method="post" action="">
<input type="hidden" name="url" value="" />
<input type="hidden" name="title" value="" />
<input type="hidden" name="trburl" value="" />
</form>
<div style="z-index:9901;top:764px;left:169px;display:none;" id="egloo_bookmark" class="popupWrap">
    <div class="popupTitle">이글루링크 추가하기</div>
    <dl class="popupBody">
        <dt class="no-arrow" style="background:none;font-size:12px;text-align:center;">
            <span id="egloo-bookmark-url" style="color:#0F71A1;"></span>
            (<span id="egloo-bookmark-name"></span>)을(를)</dt>
        <dd class="notice" style="margin:0;padding:0 0 0 8px;line-height:1.8em;color:#000;font-size:12px;text-align:center;">이글루링크로 추가하시겠습니까? 추가하시려면 그룹선택을 하세요.</dd>
        <dd class="notice weak" style="margin:0;padding:0 0 0 8px;line-height:1.8em;font-size:11px;color:#666666;text-align:center;">(그룹선택 하지 않는 경우, 최상단 목록에 추가됩니다.)</dd>
        <dd class="egloo-bookmark-group" style="margin:0;padding:10px 0 8px;line-height:1.8em;text-align:center;color:#333;font-size:12px;text-align:center;">그룹선택 :
            <select name="groupID" id="egloo-bookmark-groupID" style="font-family:'돋움','dotum','Trebuchet MS',Sans-serif;margin-left:10px;"><option value="000">그룹선택없음</option></select></dd>
        <dd class="buttons">
            <input type="button" value="지금 확인" onfocus="blur();" onclick="Modal.insertBookmark(true);" class="button btn24 btn_bold"/>
            <input type="button" value="나중에 확인" onfocus="blur();" onclick="Modal.insertBookmark(false);" class="button btn24 btn_weak"/>
        </dd>
        <dd class="close" onclick="Modal.close();"><img src="http://md.egloos.com/img/www/btn/button_popup_close.gif" alt="이글루링크 취소" title="이글루링크 취소" /></dd>
    </dl>
</div>
</body>
</html>
